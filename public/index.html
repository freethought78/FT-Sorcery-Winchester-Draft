<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorcery Winchester Cube Draft</title>
</head>
<body>
    <div id="stage">
        <h1>Connecting to draft server...</h1>
        <div id="messages"></div>
    </div>
</body>
</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jsSHA/3.3.1/sha256.min.js" integrity="sha512-qw5xqZrce8QejL/YnoVvHaXggvfJK3bP2rczgxPSL+JhACfJhOU6gG+/c1LFyRxIpwaF8pZlfwUXLIK+5EEiKA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="WebsocketHandler.js"></script>
<script src="ConfigurationScreen.js"></script>
<script src="DraftScreen.js"></script>
<script src="AwaitClientScreen.js"></script>

<script>
    userID = new URLSearchParams(window.location.search).get("id")
    secureID = hash(userID)

    stage = document.getElementById('stage')
    screen_width = window.innerWidth
    screen_height = window.innerHeight

    async function loadSorceryFont() {
        const SorceryFont = new FontFace('SorceryFont', 'url(SorceryFont.ttf)');

        try {
            await SorceryFont.load();
            document.fonts.add(SorceryFont);
            // Use the font
            document.body.style.fontFamily = 'SorceryFont';
        } catch (error) {
            console.error('Error loading font:', error);
        }
    }

    loadSorceryFont();

    var inactive_tab_interval

    //if the user is on another page, they might miss a state update, reload the page on page focus to stay up to date
    window.addEventListener('focus', (event) => {
        clearInterval(inactive_tab_interval)
    });

    window.addEventListener('blur', (event) => {
        inactive_tab_interval = setInterval(()=>{
            requestStateUpdate()
        }, 1000)
    });

    //reload page on resize
    window.addEventListener('resize', (event) => {
        window.location.reload();
    });

    function buildStage(state){
        if(state.phase == "configuration") configurationScreen(state)
        if(state.phase == "draft") draftScreen(state)
        if(state.phase == "await_client") awaitClientScreen(state)
    }

    function hash(id){
        var sha256 = new jsSHA('SHA-256', 'TEXT');
        sha256.update(id);
        return sha256.getHash("HEX");
    }

</script>
<style>
    body{
        color: #386dff;
        background-image: linear-gradient(to bottom, #010002, #06000e, #090016, #0c001d, #0b0024, #0a0129, #08012e, #040233, #030437, #02063b, #010840, #000944);
        overflow: hidden;
        margin: 0px;
    }
    #stage{
        height: 100vh;
        width: 100%;
    }
</style>